<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>BET300 ¬∑ Promos Orbital</title>
<meta name="theme-color" content="#0b1120"/>
<style>
:root{
  --bg:#0b1120; --panel:#0f172a; --panel2:#0b1326; --border:#1e2a4a;
  --text:#e8ecff; --muted:#9aa3c7; --gold:#e8c25e; --cyan:#49b6ff; --ok:#25d366;
  --accent1:#7c59ff; --accent2:#22d3ee; --hot:#ff5c39; --sun:#ffd48a;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:radial-gradient(1000px 600px at 70% -10%, rgba(124,89,255,.18), transparent),
               radial-gradient(800px 480px at 0% 0%, rgba(34,211,238,.14), transparent),
               var(--bg); color:var(--text);
     font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto}

/* Layout */
.wrap{max-width:860px;margin:10px auto 86px;padding:0 12px}
.card{background:linear-gradient(180deg, rgba(124,89,255,.08), rgba(34,211,238,.08)), var(--panel);
      border:1px solid var(--border); border-radius:18px; padding:12px; box-shadow:0 18px 50px rgba(0,0,0,.38)}
@media(max-width:520px){.card{border-radius:12px}}

/* Head */
.head{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:6px}
.brandBox{display:flex;align-items:center;gap:10px}
.logo{height:42px;display:block}
.brandText{font-weight:900;letter-spacing:.8px;font-size:28px;
           background:linear-gradient(180deg,#fff,#f6e6b0 65%,#caa94b);
           -webkit-background-clip:text;background-clip:text;color:transparent}
.pill{background:linear-gradient(90deg,rgba(124,77,255,.13),rgba(0,209,255,.13));
      border:1px solid var(--border); border-radius:999px; padding:6px 8px; font-size:12px; color:var(--muted)}
.pill.time{display:flex;gap:6px;align-items:center}
.count{display:inline-flex;gap:6px;align-items:center;padding:3px 8px;border-radius:999px;background:rgba(255,204,0,.15);
  border:1px solid rgba(255,204,0,.35);color:#ffe27a;font-weight:700;font-variant-numeric:tabular-nums}
.rightTop{margin-left:auto;display:flex;gap:8px;align-items:center}
.btnLink{display:inline-flex;gap:8px;align-items:center;padding:8px 10px;border-radius:12px;font-weight:800;
  background:linear-gradient(90deg,#7c59ff,#00d1ff);color:#0a0f1f;text-decoration:none;border:1px solid rgba(255,255,255,.06)}

/* Orbital */
.stage{display:grid;place-items:center;margin:6px 0}
.orbitWrap{position:relative;width:min(480px,94vw);height:min(480px,94vw);max-width:520px}
.centerDot{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  width:18px;height:18px;border-radius:50%;background:linear-gradient(180deg,#ffd48a,#e9b84f);
  box-shadow:0 0 16px rgba(233,184,79,.6), 0 0 32px rgba(124,89,255,.35)}
.orbit{position:absolute;inset:0;display:grid;place-items:center; perspective:900px}
.ring{position:relative;width:100%;height:100%;transform-style:preserve-3d;
  animation:spin 18s linear infinite}
@keyframes spin{from{transform:rotateZ(0deg) rotateX(18deg)}to{transform:rotateZ(360deg) rotateX(18deg)}}

/* Items */
.item{position:absolute;left:50%;top:50%;transform-style:preserve-3d;
  width:120px;height:120px;margin:-60px;display:flex;flex-direction:column;align-items:center;justify-content:center;
  border-radius:16px;background:linear-gradient(160deg, rgba(124,89,255,.22), rgba(34,211,238,.18));
  border:1px solid rgba(255,255,255,.08); box-shadow:0 10px 28px rgba(0,0,0,.35);
  text-align:center; user-select:none;}
.item h4{margin:6px 0 0;font-size:14px}
.item .emoji{font-size:36px}
.item .tag{font-size:11px;color:var(--muted)}
.item.glow{box-shadow:0 0 0 2px rgba(124,89,255,.45), 0 0 36px rgba(124,89,255,.45), 0 10px 28px rgba(0,0,0,.45)}
.item:nth-child(1){transform:rotateZ(0deg) translateY(-38%) translateZ(90px)}
.item:nth-child(2){transform:rotateZ(90deg) translateY(-38%) translateZ(90px)}
.item:nth-child(3){transform:rotateZ(180deg) translateY(-38%) translateZ(90px)}
.item:nth-child(4){transform:rotateZ(270deg) translateY(-38%) translateZ(90px)}
@media(max-width:420px){.item{width:102px;height:102px;margin:-51px}.item .emoji{font-size:30px}}

/* Title & status */
.titleBox{text-align:center;margin-top:6px}
h1{font-size:20px;margin:0 0 4px}
.sub{color:var(--muted);font-size:13px;margin:0}

/* Info + history */
.infoRow{display:grid;grid-template-columns:1fr;gap:8px;margin-top:8px}
.panel{background:var(--panel2);border:1px solid var(--border);border-radius:12px;padding:10px}
.small{font-size:12px;color:var(--muted)}
.badge{display:inline-block;min-width:66px;height:36px;border-radius:10px;background:radial-gradient(100% 100% at 50% 0%, rgba(0,209,255,.35), rgba(124,77,255,.35));
  display:grid;place-items:center;font-weight:800;font-size:16px;box-shadow:inset 0 0 10px rgba(124,77,255,.35)}
.history h3{font-size:14px;color:var(--muted);margin:0 0 6px}
.history ul{list-style:none;padding:0;margin:0;display:grid;gap:4px}
.history li{font-size:12px;color:var(--muted);border:1px dashed var(--border);border-radius:10px;padding:6px 8px}

/* Dock */
.dock{position:fixed;left:0;right:0;bottom:0;z-index:20;background:linear-gradient(180deg, rgba(11,15,30,0) 0%, rgba(11,15,30,.85) 22%, rgba(11,15,30,.95) 100%);
  padding:8px 10px 10px;display:flex;gap:8px}
.btn{appearance:none;border:none;cursor:pointer;padding:12px 14px;border-radius:14px;font-weight:800;background:linear-gradient(90deg,#ff9a3d,#ff5c39);color:#0b0f1e;width:100%;
  box-shadow:0 8px 20px rgba(0,0,0,.35)}
.btn:disabled{opacity:.6;cursor:not-allowed}
.btn.spin{background:linear-gradient(90deg,#ffd48a,#e9b84f);color:#0b0f1e}
.btn.ok{background:#25D366;color:#0b0f1e}

/* Confetti */
.confetti{position:fixed;inset:0;pointer-events:none;z-index:40}
.confetti i{position:absolute;top:-20px;width:10px;height:14px;border-radius:2px;opacity:0;animation:confFall 1.6s linear forwards}
@keyframes confFall{8%{opacity:1}100%{transform:translateY(110vh) rotate(360deg);opacity:0}}

/* Modal */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(4,6,14,.6);backdrop-filter:blur(4px);z-index:60}
.modal.show{display:flex}
.modalCard{width:min(520px,92vw);background:var(--panel2);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:0 20px 50px rgba(0,0,0,.45)}
.modalHead{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.modalHead h3{margin:0;font-size:18px}
.modalBody{display:grid;gap:8px}
.row{display:flex;gap:8px;align-items:center;justify-content:space-between;border:1px dashed var(--border);border-radius:12px;padding:10px}
.k{color:var(--muted);font-size:13px}
.v{font-weight:800}
.actions{display:flex;gap:8px;margin-top:8px}
.btn.ghost{background:transparent;color:var(--text);border:1px solid var(--border)}
.closeX{margin-left:auto;cursor:pointer;opacity:.8}
.closeX:hover{opacity:1}
footer{color:var(--muted);text-align:center;margin:12px 0 6px;font-size:12px}
</style>
</head>
<body>
<div id="confetti" class="confetti" aria-hidden="true"></div>

<!-- MODAL -->
<div id="prizeModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modalCard">
    <div class="modalHead">
      <h3 id="modalTitle">üéÅ Promo obtenida</h3>
      <span id="closeModal" class="closeX">‚úñ</span>
    </div>
    <div class="modalBody">
      <div class="row"><span class="k">Promo</span><span class="v" id="mPrize">‚Äî</span></div>
      <div class="row"><span class="k">C√≥digo</span><span class="v" id="mCode">‚Äî</span></div>
      <div class="row"><span class="k">Fecha/Hora</span><span class="v" id="mTs">‚Äî</span></div>
      <div class="actions">
        <button id="goGame" class="btn">üéÆ Ir al juego</button>
        <button id="goPlatform" class="btn spin">üöÄ Ingresar a la plataforma</button>
        <button id="goWA" class="btn ok">üí¨ WhatsApp</button>
        <button id="mClose" class="btn ghost">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<div class="wrap">
  <div class="card">
    <div class="head">
      <div class="brandBox">
        <!-- Logo en mismo directorio. Fallback a texto si no existe -->
        <img src="bet300-logo.png" class="logo" alt="BET300" onerror="this.remove();document.getElementById('brandText').style.display='block'">
        <div id="brandText" class="brandText" style="display:none">BET300</div>
      </div>
      <span class="pill">Promos interactivas</span>
      <span class="pill time">‚ö° Quedan <span class="count" id="countdown">--:--</span></span>
      <div class="rightTop">
        <a id="btnTopPlatform" class="btnLink" target="_blank" rel="noopener">üéÆ Entrar a la plataforma</a>
      </div>
    </div>

    <div class="stage">
      <div class="orbitWrap">
        <div class="centerDot"></div>
        <div class="orbit">
          <div id="ring" class="ring">
            <!-- √çtems (se completan en JS para poder permutar/rotar) -->
          </div>
        </div>
      </div>
    </div>

    <div class="titleBox">
      <h1 id="h1">Carrusel Orbital ¬∑ Eleg√≠ tu suerte</h1>
      <p class="sub" id="sub">Ten√©s 1 intento por d√≠a. Si sale tu promo, la aplic√°s en tu pr√≥xima carga.</p>
    </div>

    <div class="infoRow">
      <div class="panel"><div class="small"><b>Resultado actual:</b> <span id="resultLine">‚Äî</span></div></div>
      <div class="panel history">
        <h3>üïì √öltimos intentos</h3>
        <ul id="historyList"></ul>
      </div>
    </div>
  </div>
  <footer>BET300 ¬© ‚Äî Todos los derechos reservados.</footer>
</div>

<!-- Dock -->
<div class="dock">
  <button id="spinBtn" class="btn spin">üéØ Girar</button>
</div>

<script>
/* ====== Config por PC ====== */
const params = new URLSearchParams(location.search);
const pc = (params.get('pc') || '1').trim();
const pcKey = ['1','2','3','4'].includes(pc) ? pc : '1';

const WHATS = {
  '1': '5491171561685',
  '2': '5491171561022',
  '3': '549117331067',   // si tu n√∫mero real es 1171331067, correg√≠ aqu√≠
  '4': '5491135854862'
};
// Corrijo el tipeo del 3:
WHATS['3'] = '5491171331067';

const PLATFORM = {
  '1': 'https://bet300.site/html/primer-ingreso',
  '2': 'https://bet300.site/html/primer-ingreso',
  '3': 'https://bet300.site/html/primer-ingreso',
  '4': 'https://bet300.site/html/primer-ingreso'
};

const GAME_BASE = {
  ruleta:   'https://ruleta-bet300.vercel.app/?pc=',
  slot:     'https://slot-bet300-ch.vercel.app/?pc=',
  cofre:    'https://mistery-box-one.vercel.app/?pc=',
  memoplay: 'https://bet300-memoplay.vercel.app/?pc='
};
// PC4 solo ruleta y slot ‚Üí fallback a ruleta para cofre/memo
function gameLinkFor(promoKey){
  if(pcKey==='4' && (promoKey==='cofre' || promoKey==='memoplay')){
    return GAME_BASE['ruleta'] + pcKey;
  }
  return (GAME_BASE[promoKey] || GAME_BASE['ruleta']) + pcKey;
}

document.getElementById('btnTopPlatform').href = PLATFORM[pcKey];

/* ====== Antifraude / l√≠mites ====== */
const SALT = "bet300-orbital-v1";
function ensureDeviceId(){
  let id = localStorage.getItem('orb_device_id');
  if(!id){ id = (crypto.randomUUID?.() || `${Date.now()}-${Math.random().toString(36).slice(2,8)}`); localStorage.setItem('orb_device_id', id); }
  return id;
}
const DEVICE_ID = ensureDeviceId();
function todayKey(){const n=new Date();return `${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,'0')}-${String(n.getDate()).padStart(2,'0')}`}
function tsString(d=new Date()){
  const dd=String(d.getDate()).padStart(2,'0'),mm=String(d.getMonth()+1).padStart(2,'0'),yyyy=d.getFullYear();
  const hh=String(d.getHours()).padStart(2,'0'),mi=String(d.getMinutes()).padStart(2,'0');
  return `${dd}/${mm}/${yyyy} ${hh}:${mi}`;
}
async function sha256hex(msg){
  const enc = new TextEncoder().encode(msg);
  const buf = await crypto.subtle.digest("SHA-256", enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
}
async function makeClaimCode(prizeLabel){
  const base = `${DEVICE_ID}|${todayKey()}|${prizeLabel}|pc:${pcKey}|${SALT}`;
  const hex = await sha256hex(base);
  return hex.slice(0,10).toUpperCase();
}

/* ====== Promos (4) ====== */
const PROMOS = [
  { key:'ruleta',   label:'Ruleta',     emoji:'üé°',  tag:'Giro de promo' },
  { key:'slot',     label:'Slot',       emoji:'üé∞',  tag:'Slot de la Suerte' },
  { key:'cofre',    label:'Cofre',      emoji:'üß∞',  tag:'Mistery Box' },
  { key:'memoplay', label:'MemoPlay',   emoji:'üß†',  tag:'Memoria' }
];

/* ====== Carrusel Orbital ====== */
const ring = document.getElementById('ring');
function renderItems(order=PROMOS){
  ring.innerHTML = '';
  order.forEach(p=>{
    const el = document.createElement('div');
    el.className = 'item';
    el.dataset.key = p.key;
    el.innerHTML = `<div class="emoji">${p.emoji}</div><h4>${p.label}</h4><div class="tag">${p.tag}</div>`;
    ring.appendChild(el);
  });
}
renderItems();

/* Idle auto-rotate ya est√° por CSS. Para ‚Äúgiro‚Äù forzado: pausamos, aplicamos rotZ animada */
let spinning=false, currentAngle=0, idle=true;

function setRingPaused(paused){
  ring.style.animationPlayState = paused ? 'paused' : 'running';
}

function pickWinnerIndex(){
  // Todas con igual prob (pod√©s sesgar si quer√©s)
  return Math.floor(Math.random()*PROMOS.length); // 0..3
}

function angleForIndex(ix){
  // Nuestros items est√°n a 0¬∞, 90¬∞, 180¬∞, 270¬∞ alrededor del centro.
  // Queremos que el ganador caiga ‚Äúarriba‚Äù (posici√≥n 0¬∞).
  // Si winner est√° en ix, debemos rotar ring para traer ese √≠ndice a 0¬∞.
  return -90*ix; // grados
}

function easeOutCubic(t){ return 1 - Math.pow(1-t,3); }

function spinToWinner(wIndex, onDone){
  if(spinning) return;
  spinning=true; idle=false; setRingPaused(true);

  // Partimos del √°ngulo actual (por si hubo spoil de idle)
  const base = currentAngle % 360;
  // Vueltas extra para sensaci√≥n (>= 2 giros)
  const extra = 720 + Math.floor(Math.random()*360);
  const target = base + extra + (angleForIndex(wIndex) - (base%360));

  const start = performance.now();
  const dur = 2300; // ms

  function anim(t){
    const k = Math.min(1,(t-start)/dur);
    const e = easeOutCubic(k);
    const ang = base + (target-base)*e;
    currentAngle = ang;
    ring.style.transform = `rotateZ(${ang}deg) rotateX(18deg)`;
    if(k<1) requestAnimationFrame(anim);
    else { spinning=false; if(onDone) onDone(); }
  }
  requestAnimationFrame(anim);
}

/* ====== UI / Modal ====== */
const spinBtn = document.getElementById('spinBtn');
const resultLine = document.getElementById('resultLine');
const historyList = document.getElementById('historyList');
const prizeModal = document.getElementById('prizeModal');
const mPrize = document.getElementById('mPrize');
const mCode  = document.getElementById('mCode');
const mTs    = document.getElementById('mTs');
const goGame = document.getElementById('goGame');
const goPlatform = document.getElementById('goPlatform');
const goWA = document.getElementById('goWA');
const mClose = document.getElementById('mClose');
const closeModalX = document.getElementById('closeModal');
document.getElementById('goPlatform').onclick = ()=> location.href = PLATFORM[pcKey];
document.getElementById('btnTopPlatform').onclick = (e)=>{ e.preventDefault(); location.href = PLATFORM[pcKey]; };

function openModal(promo){
  prizeModal.classList.add('show');
  // glow en la seleccionada por 1.2s
  ring.querySelectorAll('.item').forEach((el,idx)=>{
    el.classList.toggle('glow', PROMOS[idx].key===promo.key);
  });
  setTimeout(()=> ring.querySelectorAll('.item').forEach(el=>el.classList.remove('glow')), 1200);
}
function closeModal(){ prizeModal.classList.remove('show'); }
mClose.onclick = closeModal; closeModalX?.addEventListener('click', closeModal);
prizeModal.addEventListener('click',e=>{ if(e.target===prizeModal) closeModal(); });

/* ====== Confetti ====== */
function confettiBurst(){
  const el=document.getElementById('confetti'); el.innerHTML='';
  const n=28;
  for(let i=0;i<n;i++){
    const p=document.createElement('i');
    p.style.left=(Math.random()*100)+'vw';
    p.style.animationDelay=(Math.random()*0.5)+'s';
    p.style.background = Math.random()<.5?'linear-gradient(#80ffea,#4e9cff)':'linear-gradient(#ffd166,#ff3d7f)';
    el.appendChild(p);
  }
  setTimeout(()=>{el.innerHTML='';},1800);
}

/* ====== Sonido suave ====== */
const AudioKit = (()=>{
  const Ctx = window.AudioContext || window.webkitAudioContext;
  let ctx=null, unlocked=false;
  function unlock(){ if(!ctx){ ctx = new Ctx(); } if(!unlocked){ ctx.resume().catch(()=>{}); unlocked=true; } }
  function blip(freq=900,dur=0.04,vol=0.05,type='triangle'){
    if(!ctx) return;
    const o=ctx.createOscillator(), g=ctx.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=0; o.connect(g).connect(ctx.destination);
    const t=ctx.currentTime; g.gain.linearRampToValueAtTime(vol, t+0.005); g.gain.exponentialRampToValueAtTime(0.0001, t+dur); o.start(t); o.stop(t+dur);
  }
  function tick(){ blip(820+Math.random()*220,0.03,0.05,'square'); }
  function win(){ [660,880,1100].forEach((f,i)=>setTimeout(()=>blip(f,0.1,0.08,'sawtooth'), i*120)); }
  return {unlock,tick,win};
})();
document.addEventListener('click',()=>AudioKit.unlock(),{once:true});

/* ====== Historial ====== */
function pushHistory(entry){
  const arr = JSON.parse(localStorage.getItem('orb_hist')||"[]");
  arr.unshift(entry);
  while(arr.length>5) arr.pop();
  localStorage.setItem('orb_hist', JSON.stringify(arr));
}
function renderHistory(){
  const arr = JSON.parse(localStorage.getItem('orb_hist')||"[]");
  historyList.innerHTML = arr.map(e=>`<li>${e.ts} ¬∑ ${e.prize} ¬∑ ${e.text}</li>`).join('') || '<li>Sin registros</li>';
}

/* ====== L√≠mite diario ====== */
function restoreDaily(){
  const today=todayKey(); const stored=localStorage.getItem('orb_date');
  if(stored && stored!==today){
    localStorage.removeItem('orb_done');
    localStorage.removeItem('orb_prize');
    localStorage.removeItem('orb_code');
    localStorage.removeItem('orb_ts');
    localStorage.setItem('orb_date',today);
  }else if(!stored){ localStorage.setItem('orb_date',today); }
}
function scheduleMidnightReset(){
  const now=new Date(); const midnight=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1,0,0,5,0);
  setTimeout(()=>{localStorage.removeItem('orb_done');localStorage.removeItem('orb_prize');localStorage.removeItem('orb_code');localStorage.removeItem('orb_ts');localStorage.setItem('orb_date',todayKey());
    resultLine.textContent='‚Äî';
  }, midnight.getTime()-now.getTime());
}

/* ====== Countdown ====== */
function endOfDay(){const n=new Date();const end=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,0,0).getTime();
  return end>Date.now()?end:new Date(n.getFullYear(),n.getMonth(),n.getDate()+1,23,59,0,0).getTime()}
function tickCountdown(){
  const ms=endOfDay()-Date.now(); const total=Math.max(0,Math.floor(ms/1000));
  const h=Math.floor(total/3600), m=Math.floor((total%3600)/60), s=total%60;
  document.getElementById('countdown').textContent=h>0?`${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`:`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

/* ====== Spin ====== */
spinBtn.addEventListener('click', async ()=>{
  if(spinning) return;
  if(localStorage.getItem('orb_done')==='1'){ alert("Ya usaste tu intento de hoy"); return; }

  const winner = pickWinnerIndex();
  // peque√±os ticks de audio durante ~1.2s
  let ticks=0; const tickInt = setInterval(()=>{ AudioKit.tick(); if(++ticks>12) clearInterval(tickInt); },90);

  spinToWinner(winner, async ()=>{
    const promo = PROMOS[winner];
    const prizeLabel = promo.label;
    const code = await makeClaimCode(prizeLabel);
    const ts = tsString(new Date());

    localStorage.setItem('orb_code', code);
    localStorage.setItem('orb_ts', ts);
    localStorage.setItem('orb_prize', JSON.stringify({promo:promo.key, label:prizeLabel}));
    localStorage.setItem('orb_done','1');

    // UI
    resultLine.textContent = `Ganaste: ${prizeLabel}`;
    mPrize.textContent = prizeLabel;
    mCode.textContent = code;
    mTs.textContent = ts;

    // Acciones
    goGame.onclick = ()=> location.href = gameLinkFor(promo.key);
    goPlatform.onclick = ()=> location.href = PLATFORM[pcKey];
    goWA.onclick = ()=> location.href = `https://wa.me/${WHATS[pcKey]}?text=${encodeURIComponent(`Hola! Gan√© la promo: ${prizeLabel}. C√≥digo: ${code} ¬∑ ${ts}`)}`;

    pushHistory({ts, prize:prizeLabel, text:`${prizeLabel} (pc ${pcKey})`});
    renderHistory();
    AudioKit.win();
    confettiBurst();
    openModal(promo);
  });
});

/* ====== Init ====== */
function init(){
  restoreDaily(); renderHistory(); tickCountdown(); scheduleMidnightReset();
  setInterval(tickCountdown,1000);
  // Enlace arriba
  document.getElementById('btnTopPlatform').href = PLATFORM[pcKey];
}
init();
</script>
</body>
</html>
