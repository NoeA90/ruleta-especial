<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>BET300 ¬∑ Promo Cubo</title>
<meta name="theme-color" content="#0b1120"/>
<style>
  :root{
    --bg:#0b1120; --panel:#0f172a; --panel2:#0b1326; --border:#1e2a4a;
    --text:#e8ecff; --muted:#9aa3c7; --accent:#49b6ff; --gold:#e8c25e; --ok:#25d366;
    --cube:#111a33; --glow:#7c59ff; --cyan:#22d3ee;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto}
  .wrap{max-width:960px;margin:18px auto 90px;padding:0 14px}
  .head{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:8px}
  .brandBox{display:flex;align-items:center;gap:10px}
  .logo{height:48px;display:block}
  .brandText{font-weight:900;letter-spacing:.6px;font-size:28px;
    background:linear-gradient(180deg,#fff,#f6e6b0 65%,#caa94b);
    -webkit-background-clip:text;background-clip:text;color:transparent}
  .pill{margin-left:auto;background:rgba(73,182,255,.12);border:1px solid var(--border);
    border-radius:999px;padding:6px 10px;font-size:12px;color:var(--muted)}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:18px;padding:14px;box-shadow:0 20px 50px rgba(0,0,0,.35)}

  .grid{display:grid;gap:12px}
  @media(min-width:900px){.grid{grid-template-columns:1.05fr .95fr}}

  .stage{display:grid;place-items:center;background:
    radial-gradient(80% 120% at 50% 0%,rgba(124,89,255,.12),transparent),
    radial-gradient(60% 100% at 0% 100%,rgba(34,211,238,.10),transparent),
    var(--panel2);
    border:1px solid var(--border);border-radius:16px;min-height:360px;position:relative;overflow:hidden}
  .btn{appearance:none;border:none;cursor:pointer;padding:13px 16px;border-radius:14px;font-weight:800}
  .btn.primary{background:linear-gradient(90deg,#ffd48a,#e9b84f);color:#09121f;box-shadow:0 10px 24px rgba(233,184,79,.25)}
  .btn.secondary{background:#1fbf61;color:#07131e;border:1px solid rgba(255,255,255,.08);box-shadow:0 8px 20px rgba(31,191,97,.25)}
  .btn.ghost{background:transparent;color:var(--text);border:1px solid var(--border)}
  .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}

  /* CUBE 3D */
  .cubeWrap{width:min(420px,88vw);height:min(420px,88vw);max-height:420px;perspective:1200px}
  .cube{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform 1200ms cubic-bezier(.22,1,.36,1)}
  .face{
    position:absolute;inset:0;display:grid;place-items:center;border-radius:16px;
    background:linear-gradient(180deg,#0f1a39,#0b132a);
    border:1px solid #2a3660; box-shadow:inset 0 0 0 1px rgba(255,255,255,.04),0 20px 50px rgba(0,0,0,.45);
  }
  .face h2{margin:0;font-weight:900;letter-spacing:.6px;text-transform:uppercase}
  .face p{margin:6px 0 0;color:var(--muted);font-size:13px}
  /* colores por cara */
  .f-ruleta {background:linear-gradient(180deg,#1b2548,#121b36)}
  .f-slot   {background:linear-gradient(180deg,#1a2d3f,#102235)}
  .f-cofre  {background:linear-gradient(180deg,#2a243f,#171531)}
  .f-memo   {background:linear-gradient(180deg,#203241,#142536)}
  .glow{position:absolute;inset:-2px;border-radius:18px;box-shadow:0 0 28px rgba(124,89,255,.35), 0 0 18px rgba(34,211,238,.25);opacity:0;transition:opacity .25s}
  .face.active .glow{opacity:1}

  /* posicionar caras (cubo de 4 caras alrededor del eje Y) */
  .cube .face{--z: calc(var(--size,50vmin)/2); }
  .front {transform:translateZ(var(--z))}
  .right {transform:rotateY(90deg) translateZ(var(--z))}
  .back  {transform:rotateY(180deg) translateZ(var(--z))}
  .left  {transform:rotateY(-90deg) translateZ(var(--z))}

  /* panel lateral */
  .side{background:var(--panel2);border:1px solid var(--border);border-radius:16px;padding:12px}
  .side h3{margin:0 0 8px}
  .row{display:flex;justify-content:space-between;align-items:center;margin:6px 0;padding:8px;border:1px dashed var(--border);border-radius:12px}
  .k{color:var(--muted);font-size:13px}
  .v{font-weight:800}
  .small{font-size:12px;color:var(--muted)}

  /* Confetti */
  .confetti{position:fixed;inset:0;pointer-events:none;z-index:40}
  .confetti i{position:absolute;top:-20px;width:10px;height:14px;border-radius:2px;opacity:0;animation:confFall 1.6s linear forwards}
  @keyframes confFall{8%{opacity:1}100%{transform:translateY(110vh) rotate(360deg);opacity:0}}

  /* Modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(4,6,14,.6);backdrop-filter:blur(4px);z-index:60}
  .modal.show{display:flex}
  .modalCard{width:min(520px,92vw);background:var(--panel2);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:0 20px 50px rgba(0,0,0,.45)}
  .modalHead{display:flex;align-items:center;gap:8px;margin-bottom:8px}
  .modalHead h3{margin:0;font-size:18px}
  .closeX{margin-left:auto;cursor:pointer;opacity:.8}
  .closeX:hover{opacity:1}

  /* Dock */
  .dock{position:fixed;left:0;right:0;bottom:0;z-index:20;background:linear-gradient(180deg, rgba(11,15,30,0) 0%, rgba(11,15,30,.85) 22%, rgba(11,15,30,.95) 100%);
    padding:8px 10px 10px;display:flex;gap:8px}
  .btn.full{width:100%}

  /* Compacto m√≥vil */
  @media(max-width:420px){
    .cubeWrap{height:78vw;max-height:none}
    .face h2{font-size:18px}
  }
</style>
</head>
<body>
  <div id="confetti" class="confetti" aria-hidden="true"></div>

  <!-- MODAL -->
  <div id="prizeModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modalCard">
      <div class="modalHead">
        <h3 id="modalTitle">üéÅ Beneficio obtenido</h3>
        <span id="closeModal" class="closeX">‚úñ</span>
      </div>
      <div class="modalBody">
        <div class="row"><span class="k">Promo</span><span class="v" id="mPrize">‚Äî</span></div>
        <div class="row"><span class="k">C√≥digo</span><span class="v" id="mCode">‚Äî</span></div>
        <div class="row"><span class="k">Fecha/Hora</span><span class="v" id="mTs">‚Äî</span></div>
        <div class="actions">
          <button id="mToGame" class="btn ghost">Ir al detalle</button>
          <button id="mToPlatform" class="btn secondary">Ingresar a la plataforma</button>
          <button id="mClaim" class="btn primary">üì≤ Reclamar por WhatsApp</button>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="head">
      <div class="brandBox">
        <!-- Logo: archivo en el mismo directorio -->
        <img class="logo" src="bet300-logo.png" alt="BET300" onerror="this.remove();document.getElementById('brandText').style.display='block'">
        <div id="brandText" class="brandText" style="display:none">BET300</div>
      </div>
      <span class="pill">Autogesti√≥n habilitada</span>
    </div>

    <div class="card">
      <div class="grid">
        <div class="stage">
          <div class="cubeWrap">
            <div id="cube" class="cube">
              <div class="face front f-ruleta"><div class="glow"></div><div><h2>Ruleta</h2><p>Una tirada</p></div></div>
              <div class="face right f-slot"><div class="glow"></div><div><h2>Slot</h2><p>1 giro</p></div></div>
              <div class="face back f-cofre"><div class="glow"></div><div><h2>Cofre</h2><p>Misterioso</p></div></div>
              <div class="face left f-memo"><div class="glow"></div><div><h2>Memoplay</h2><p>1 intento</p></div></div>
            </div>
          </div>
          <div class="actions" style="margin-top:12px">
            <button id="btnSpin" class="btn primary">üé≤ Girar</button>
          </div>
        </div>

        <div class="side">
          <h3>üìå Detalles</h3>
          <div class="row"><span class="k">Estado</span><span class="v" id="st">Listo para jugar</span></div>
          <div class="row"><span class="k">Resultado</span><span class="v" id="res">‚Äî</span></div>
          <div class="row"><span class="k">Cuenta regresiva</span><span class="v" id="count">‚Äî</span></div>
          <p class="small">Ten√©s 1 intento por d√≠a. El beneficio se acredita con tu pr√≥xima carga (m√≠nima).</p>
          <div class="actions">
            <button id="btnPlatform" class="btn secondary">Ingresar a la plataforma</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Dock -->
  <div class="dock">
    <button id="btnClaim" class="btn primary full" disabled>üì≤ Reclamar</button>
  </div>

<script>
/* ========= Par√°metros por PC ========= */
const params = new URLSearchParams(location.search);
const pc = params.get('pc') || '1';
const pcKey = ['1','2','3','4'].includes(pc) ? pc : '1';

const WHATS = {
  '1': '5491171561685',
  '2': '5491171561022',
  '3': '549117331067',
  '4': '5491135854862'
};
// Si el 3 ten√≠a 1171331067, us√° exactamente ese:
WHATS['3'] = '5491171331067';

const PLATFORM = {
  '1': 'https://bet300.site/html/primer-ingreso',
  '2': 'https://bet300.site/html/primer-ingreso',
  '3': 'https://bet300.site/html/primer-ingreso',
  '4': 'https://bet300.site/html/primer-ingreso'
};

/* (Opcional) Links espec√≠ficos de cada juego por PC: complet√° si quer√©s */
const GAME_LINKS = {
  ruleta: {
    '1': 'https://ruleta-bet300.vercel.app/?pc=1',
    '2': 'https://ruleta-bet300.vercel.app/?pc=2',
    '3': 'https://ruleta-bet300.vercel.app/?pc=3',
    '4': 'https://ruleta-bet300.vercel.app/?pc=4'
  },
  slot: {
    '1': 'https://slot-bet300-ch.vercel.app/?pc=1',
    '2': 'https://slot-bet300-ch.vercel.app/?pc=2',
    '3': 'https://slot-bet300-ch.vercel.app/?pc=3',
    '4': 'https://slot-bet300-ch.vercel.app/?pc=4'
  },
  cofre: {
    '1': 'https://mistery-box-one.vercel.app/?pc=1',
    '2': 'https://mistery-box-one.vercel.app/?pc=2',
    '3': 'https://mistery-box-one.vercel.app/?pc=3',
    '4': 'https://mistery-box-one.vercel.app/?pc=4'
  },
  memoplay: {
    '1': 'https://bet300-memoplay.vercel.app/?pc=1',
    '2': 'https://bet300-memoplay.vercel.app/?pc=2',
    '3': 'https://bet300-memoplay.vercel.app/?pc=3',
    '4': 'https://bet300-memoplay.vercel.app/?pc=4'
  }
};

/* ========= Utilidades ========= */
const SALT = "bet300-cube-v1";
function ensureDeviceId(){
  let id = localStorage.getItem('cube_device');
  if(!id){ id = (crypto.randomUUID?.() || `${Date.now()}-${Math.random().toString(36).slice(2,8)}`); localStorage.setItem('cube_device', id); }
  return id;
}
const DEVICE_ID = ensureDeviceId();

function todayKey(){
  const n=new Date();
  return `${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,'0')}-${String(n.getDate()).padStart(2,'0')}`;
}
function tsString(d=new Date()){
  const dd=String(d.getDate()).padStart(2,'0'),mm=String(d.getMonth()+1).padStart(2,'0'),yyyy=d.getFullYear();
  const hh=String(d.getHours()).padStart(2,'0'),mi=String(d.getMinutes()).padStart(2,'0');
  return `${dd}/${mm}/${yyyy} ${hh}:${mi}`;
}
async function sha256hex(msg){
  const enc = new TextEncoder().encode(msg);
  const buf = await crypto.subtle.digest("SHA-256", enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
}
async function makeCode(label){
  const base = `${DEVICE_ID}|${todayKey()}|${label}|pc:${pc}|${SALT}`;
  const hex = await sha256hex(base);
  return hex.slice(0,10).toUpperCase();
}
function confetti(){
  const el=document.getElementById('confetti'); el.innerHTML='';
  const n=28; for(let i=0;i<n;i++){
    const p=document.createElement('i');
    p.style.left=(Math.random()*100)+'vw';
    p.style.animationDelay=(Math.random()*0.5)+'s';
    p.style.background = Math.random()<.5?'linear-gradient(#80ffea,#4e9cff)':'linear-gradient(#ffd166,#ff3d7f)';
    el.appendChild(p);
  } setTimeout(()=>{el.innerHTML='';},1800);
}

/* ========= Estado UI ========= */
const cube = document.getElementById('cube');
const faces = cube.querySelectorAll('.face');
const btnSpin = document.getElementById('btnSpin');
const btnPlatform = document.getElementById('btnPlatform');
const btnClaim = document.getElementById('btnClaim');
const st = document.getElementById('st');
const res = document.getElementById('res');
const count = document.getElementById('count');

/* Modal */
const prizeModal = document.getElementById('prizeModal');
const mPrize = document.getElementById('mPrize');
const mCode  = document.getElementById('mCode');
const mTs    = document.getElementById('mTs');
const mToGame = document.getElementById('mToGame');
const mToPlatform = document.getElementById('mToPlatform');
const mClaim = document.getElementById('mClaim');
const closeModalX = document.getElementById('closeModal');

function openModal(){ prizeModal.classList.add('show'); }
function closeModal(){ prizeModal.classList.remove('show'); }
closeModalX.onclick = closeModal;
prizeModal.addEventListener('click',e=>{ if(e.target===prizeModal) closeModal(); });

/* ========= L√≥gica del cubo ========= */
/** Caras en orden de orientaci√≥n Y: front(0)=ruleta, right(1)=slot, back(2)=cofre, left(3)=memoplay **/
const PRIZES = [
  {key:'ruleta',  label:'Tirada en Ruleta',  faceClass:'front'},
  {key:'slot',    label:'Giro en Slot',      faceClass:'right'},
  {key:'cofre',   label:'Cofre Misterioso',  faceClass:'back'},
  {key:'memoplay',label:'Intento en Memoplay',faceClass:'left'}
];
let currentIndex = 0; // 0..3

function setActiveFace(index){
  faces.forEach(f=>f.classList.remove('active'));
  const f = faces[index];
  if(f) f.classList.add('active');
}
setActiveFace(0);

function rotationForIndex(index){
  // index 0=front(0deg), 1=right(-90deg), 2=back(-180deg), 3=left(90deg)
  const map = [0,-90,-180,90];
  const deg = map[index];
  return `rotateY(${deg}deg)`;
}

let spinning=false;
btnSpin.onclick = async () => {
  if(spinning) return;
  if(localStorage.getItem('cube_done')==='1'){ alert('Ya usaste tu intento de hoy.'); return; }
  spinning=true; st.textContent='Girando‚Ä¶'; btnSpin.disabled=true; btnClaim.disabled=true;

  // giro ‚Äúaleatorio‚Äù: varias vueltas + destino
  const target = Math.floor(Math.random()*4); // 0..3
  const extraTurns = 4 + Math.floor(Math.random()*3); // 4‚Äì6 vueltas
  currentIndex = target;

  // anim: simulamos vueltas sumando 360*extra + destino
  const baseDeg = [0,-90,-180,90][target];
  const totalDeg = (360*extraTurns) + (baseDeg<0? (360+baseDeg) : baseDeg);
  cube.style.transform = `rotateY(-${totalDeg}deg)`;

  // marcar cara activa al final
  setTimeout(async ()=>{
    setActiveFace(target);
    const prize = PRIZES[target];
    const code = await makeCode(prize.key.toUpperCase());
    const ts = tsString(new Date());

    localStorage.setItem('cube_date', todayKey());
    localStorage.setItem('cube_done','1');
    localStorage.setItem('cube_result', JSON.stringify({key:prize.key,label:prize.label,ts,code,pc}));

    res.textContent = prize.label;
    st.textContent  = '¬°Ganaste!';
    btnClaim.disabled = false;

    // Modal + acciones
    mPrize.textContent = prize.label;
    mCode.textContent  = code;
    mTs.textContent    = ts;

    mToGame.onclick = ()=>{
      const url = (GAME_LINKS[prize.key] && GAME_LINKS[prize.key][pcKey]) || PLATFORM[pcKey];
      location.href = url;
    };
    mToPlatform.onclick = ()=> location.href = PLATFORM[pcKey];

    const msg = `Hola, gan√©: ${encodeURIComponent(prize.label)} en el Cubo BET300. C√≥digo: ${code} ¬∑ ${ts}`;
    const wa  = `https://wa.me/${WHATS[pcKey]}?text=${msg}`;
    mClaim.onclick = ()=> location.href = wa;
    btnClaim.onclick = ()=> location.href = wa;

    openModal(); confetti();
    spinning=false;
  }, 1250);
};

/* ========= 1 intento por d√≠a & contador ========= */
function restoreDaily(){
  const today=todayKey(); const stored=localStorage.getItem('cube_date');
  if(stored && stored!==today){
    localStorage.removeItem('cube_done');
    localStorage.removeItem('cube_result');
    localStorage.setItem('cube_date',today);
  } else if(!stored){
    localStorage.setItem('cube_date',today);
  }
}
function restoreResult(){
  const done=localStorage.getItem('cube_done')==='1'; const saved=localStorage.getItem('cube_result');
  if(done && saved){
    const r=JSON.parse(saved);
    res.textContent=r.label||'‚Äî';
    st.textContent='Premio obtenido';
    btnSpin.disabled=true; btnClaim.disabled=false;
    const msg = `Hola, gan√©: ${encodeURIComponent(r.label)} en el Cubo BET300. C√≥digo: ${r.code} ¬∑ ${r.ts}`;
    const wa  = `https://wa.me/${WHATS[pcKey]}?text=${msg}`;
    btnClaim.onclick=()=>location.href=wa;
  }
}
function endOfDay(){const n=new Date();const end=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,0,0).getTime();
  return end>Date.now()?end:new Date(n.getFullYear(),n.getMonth(),n.getDate()+1,23,59,0,0).getTime()}
function tickCountdown(){
  const ms=endOfDay()-Date.now(); const total=Math.max(0,Math.floor(ms/1000));
  const h=Math.floor(total/3600), m=Math.floor((total%3600)/60), s=total%60;
  count.textContent=h>0?`${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`:`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}
setInterval(tickCountdown,1000);

/* ========= Botones extras ========= */
btnPlatform.onclick = ()=> location.href = PLATFORM[pcKey];

/* ========= Init ========= */
function init(){
  restoreDaily(); restoreResult(); tickCountdown();
  // set tama√±o variable para z del cubo
  const rect = document.querySelector('.cubeWrap').getBoundingClientRect();
  const size = Math.min(rect.width, rect.height);
  cube.style.setProperty('--size', size+'px');
  window.addEventListener('resize', ()=>{
    const r = document.querySelector('.cubeWrap').getBoundingClientRect();
    const s = Math.min(r.width, r.height);
    cube.style.setProperty('--size', s+'px');
  });
}
init();
</script>
</body>
</html>
